import toInteger from"../_lib/toInteger/index.js";import getTimezoneOffsetInMilliseconds from"../_lib/getTimezoneOffsetInMilliseconds/index.js";import toDate from"../toDate/index.js";import isValid from"../isValid/index.js";import defaultLocale from"../locale/en-US/index.js";import formatters from"../_lib/format/formatters/index.js";import longFormatters from"../_lib/format/longFormatters/index.js";import subMilliseconds from"../subMilliseconds/index.js";import{isProtectedToken,throwProtectedError}from"../_lib/protectedTokens/index.js";var formattingTokensRegExp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp=/^'(.*?)'?$/,doubleQuoteRegExp=/''/g;export default function format(dirtyDate,dirtyFormatStr,dirtyOptions){if(2>arguments.length){throw new TypeError("2 arguments required, but only "+arguments.length+" present")}var options=dirtyOptions||{},locale=options.locale||defaultLocale,localeFirstWeekContainsDate=locale.options&&locale.options.firstWeekContainsDate,defaultFirstWeekContainsDate=null==localeFirstWeekContainsDate?1:toInteger(localeFirstWeekContainsDate),firstWeekContainsDate=null==options.firstWeekContainsDate?defaultFirstWeekContainsDate:toInteger(options.firstWeekContainsDate);if(!(1<=firstWeekContainsDate&&7>=firstWeekContainsDate)){throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively")}var localeWeekStartsOn=locale.options&&locale.options.weekStartsOn,defaultWeekStartsOn=null==localeWeekStartsOn?0:toInteger(localeWeekStartsOn),weekStartsOn=null==options.weekStartsOn?defaultWeekStartsOn:toInteger(options.weekStartsOn);if(!(0<=weekStartsOn&&6>=weekStartsOn)){throw new RangeError("weekStartsOn must be between 0 and 6 inclusively")}if(!locale.localize){throw new RangeError("locale must contain localize property")}if(!locale.formatLong){throw new RangeError("locale must contain formatLong property")}var originalDate=toDate(dirtyDate);if(!isValid(originalDate)){throw new RangeError("Invalid time value")}var timezoneOffset=getTimezoneOffsetInMilliseconds(originalDate),utcDate=subMilliseconds(originalDate,timezoneOffset),formatterOptions={firstWeekContainsDate:firstWeekContainsDate,weekStartsOn:weekStartsOn,locale:locale,_originalDate:originalDate},result=(dirtyFormatStr+"").match(longFormattingTokensRegExp).map(function(substring){var firstCharacter=substring[0];if("p"===firstCharacter||"P"===firstCharacter){var longFormatter=longFormatters[firstCharacter];return longFormatter(substring,locale.formatLong,formatterOptions)}return substring}).join("").match(formattingTokensRegExp).map(function(substring){if("''"===substring){return"'"}var firstCharacter=substring[0];if("'"===firstCharacter){return cleanEscapedString(substring)}var formatter=formatters[firstCharacter];if(formatter){if(!options.awareOfUnicodeTokens&&isProtectedToken(substring)){throwProtectedError(substring)}return formatter(utcDate,substring,locale.localize,formatterOptions)}return substring}).join("");return result}function cleanEscapedString(input){return input.match(escapedStringRegExp)[1].replace(doubleQuoteRegExp,"'")}